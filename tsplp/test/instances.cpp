#include "MtspModel.hpp"

#include <catch2/catch.hpp>

TEST_CASE("br17.atsp", "[instances]")
{
    xt::xtensor<double, 2> weights =
    {
        // first row and column are duplicated to emulate roundtrip, TODO: do this automatically
        {9999,   0, 3, 5, 48, 48, 8, 8, 5, 5, 3, 3, 0, 3, 5, 8, 8, 5.0},
        {0,   9999, 3, 5, 48, 48, 8, 8, 5, 5, 3, 3, 0, 3, 5, 8, 8, 5.0},
        {3,   3,   9999, 3, 48, 48, 8, 8, 5, 5, 0, 0, 3, 0, 3, 8, 8, 5.0},
        {5,   5,   3, 9999, 72, 72, 48, 48, 24, 24, 3, 3, 5, 3, 0, 48, 48, 24.0},
        {48,  48,  48, 74, 9999, 0, 6, 6, 12, 12, 48, 48, 48, 48, 74, 6, 6, 12.0},
        {48,  48,  48, 74, 0, 9999, 6, 6, 12, 12, 48, 48, 48, 48, 74, 6, 6, 12.0},
        {8,   8,   8, 50, 6, 6, 9999, 0, 8, 8, 8, 8, 8, 8, 50, 0, 0, 8.0},
        {8,   8,   8, 50, 6, 6, 0, 9999, 8, 8, 8, 8, 8, 8, 50, 0, 0, 8.0},
        {5,   5,   5, 26, 12, 12, 8, 8, 9999, 0, 5, 5, 5, 5, 26, 8, 8, 0.0},
        {5,   5,   5, 26, 12, 12, 8, 8, 0, 9999, 5, 5, 5, 5, 26, 8, 8, 0.0},
        {3,   3,   0, 3, 48, 48, 8, 8, 5, 5, 9999, 0, 3, 0, 3, 8, 8, 5.0},
        {3,   3,   0, 3, 48, 48, 8, 8, 5, 5, 0, 9999, 3, 0, 3, 8, 8, 5.0},
        {0,   0,   3, 5, 48, 48, 8, 8, 5, 5, 3, 3, 9999, 3, 5, 8, 8, 5.0},
        {3,   3,   0, 3, 48, 48, 8, 8, 5, 5, 0, 0, 3, 9999, 3, 8, 8, 5.0},
        {5,   5,   3, 0, 72, 72, 48, 48, 24, 24, 3, 3, 5, 3, 9999, 48, 48, 24.0},
        {8,   8,   8, 50, 6, 6, 0, 0, 8, 8, 8, 8, 8, 8, 50, 9999, 0, 8.0},
        {8,   8,   8, 50, 6, 6, 0, 0, 8, 8, 8, 8, 8, 8, 50, 0, 9999, 8.0},
        {5,   5,   5, 26, 12, 12, 8, 8, 0, 0, 5, 5, 5, 5, 26, 8, 8, 9999.0}
    };

    xt::xtensor<int, 1> startPositions{ 0 };
    xt::xtensor<int, 1> endPositions{ 1 }; // 1 is a copy of 0

    tsplp::MtspModel model{ startPositions, endPositions, weights };
    auto result = model.BranchAndCutSolve();
    
    REQUIRE(result.lowerBound == Approx(39));
    REQUIRE(result.upperBound == Approx(39));
}